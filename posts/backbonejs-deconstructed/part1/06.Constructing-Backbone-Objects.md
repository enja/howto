# 6 - Constructing Backbone Objects

## 6.1 - Backbone Constructor Functions

When I claimed earlier that Backbone itself is simple, I did so because Backbone only provides 4 constructor functions that are typically instantiated (technically, they are extended or sub-classed first by a developer before instantiation).

These four constructors are:

```js
Backbone.Model = function(attributes, {options}){};
Backbone.Collection = function([models], {options}){};
Backbone.Router = function({options}){}; //typically instantiated once 
Backbone.View = function({options}){};
```

Let's examine the default instance and prototype properties for each of the instances created from the above constructor functions by simply instantiating each with the `new` keyword (click on the results in the JSfiddles to view instance and prototype properties) passing no parameters.

### Models:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/NNyug/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Collection:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/jbsEG/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Router:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/2XczH/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### View:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/AaJGx/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

The properties identified for each constructor function are what Backbone provides out of the box. However, it is more common that you will be extending (i.e. `Backbone.Model.extend()`) these constructors with your own domain specific instance and prototype properties and methods before you construct them.

Briefly, before we continue, let's examine the optional parameters for each constructor. More time will be spent on these parameters in the appropriate section but I think it's important to have a rough understanding of the optional parameters.

```js
var myModel = new Backbone.Model(attributes, {options});
/*
attributes = {data:value, data:value} || [value,value]

options = {
 collection: {}, 
 url: '', 
 urlRoot: '', 
 parse: boolean
}
*/


var myCollection = new Backbone.Collection(model(s), {options});
/*
models = model || [model,model,model] || {model:data} || [{model:data},{model:data}];

options = {
 url: '', 
 model: {}, 
 comparator: function(){} || ''
}
*/


var myView = new Backbone.View({options});
/*
options = {
 model: {}, 
 events: {} or function(){return {}}
 collection: {}, 
 el: '' or function(){return ''}, 
 id: '', 
 className: '' or function(){return ''}, 
 tagName: '' or function(){return ''}, 
 attributes: {attribute:value,attribute:value}
}
*/


var myRouter = new Backbone.Router({options});
/*
options = {
 routes:{}
}
*/

/*should be aware of History options as well*/
Backbone.History.start({options});
/*
options = {
 pushState: boolean,
 root: '',
 hashChange: boolean,
 silent: boolean
}
*/
```

### Notes:

- The `Router()` constructor can be instantiated more than once but given the assumption of a SPA typically its only instantiated once.
- The `Backbone.History()` constructor function is [internally constructed by the library itself](http://backbonejs.org/docs/backbone.html#section-188), one time, when the library is parsed.
- Notice that all of the instances, as previously mentioned, have the `Backbone.Events` mixed into the prototypes of each constructor.

## 6.2 - Using The Internal Backbone `extend()` Helper Function To Create Sub Classed Model(), Collection(), Router(), and View() Constructors.

The Backbone pattern for constructing a model, collection, view, or router routinely involves extending one of the default Backbone constructor functions (creating a sub class or sub constructor) with your own domain relevant properties and methods. This is accomplished with the [`extend()` function](http://backbonejs.org/docs/backbone.html#section-190) that is [a property of the constructor function](http://backbonejs.org/docs/backbone.html#section-196). Don't confuse this function with the `extend()` provided by underscore.js.

The `extend()` provided by Backbone accomplishes, from a high level, the following:

- Duplicates the instance values of the constructor function its extending
- Extends the new sub constructor with developer defined prototype
  properties and static properties
- Facilitates the prototypical inheritance between the constructor being extended and the new constructor (sub-constructor)
- Adds the `extend()` helper function to the new sub constructor function so that the sub constructor can also be extended to create an unlimited chain of sub classes
- Institutes an `initialize()` callback to be called when the sub-constructor creates instances and sets the context of the initialize function.

For a more detailed break down of how the Backbone `extend()` method works, carefully read the comments in the code below which describes the logic contained in the `extend()` function for extending a fictitious `View` constructor (similar but not precisely `Backbone.View`). While this is not the exact code contained in Backbone.js its an isolated example of what is occuring at the code level when a `Backbone.Model`, `Backbone.Collection`, `Backbone.View`, and `Backbone.Router` constructor is sub classed (or what I like to call an extended sub constructor) .

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/Ysd8w/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

Understanding `extend()`, and its role when using Backbone will take a lot of the mystery out of Backbone applications. I would suggest you examine its parts until you completely understand its purpose and function, but if you want to move past this subject quickly what you need to know about extend() boils down to one concept.

1. `extend()`, creates or extends an object with new application specific object properties so that when the extended object is instantiated it will have these new instance properties and methods.

## 6.3 - Running Initialization Code When An Extended Constructor Is Instantiated

When `extend()`'ing `Backbone.Model`, `Backbone.Collection`, `Backbone.View`, and `Backbone.Router` an `initialize` function can be setup to run anytime an instance is created from the extended constructor. Basically, initialize is a callback, which is invoked any time an instance is instantiated. In the code below I provide an initialize callback for an extended `Backbone.Model` constructor and then create an instance, which in turn runs the initialized function (works the same on `Backbone.Collection`, `Backbone.View`, and `Backbone.Router`).

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/e9PFh/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

Make sure you note that any parameters passed to an extended constructor are also passed into the initialize callback.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/TsqAt/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Notes:

- The context of the initialize function (i.e. `this`) is set to the instance created.
- When extending a Backbone constructor you have to be aware of what parameters and values the constructor permits/requires when instantiating an instance. For example, the `Backbone.Model` constructor expects as the first parameter an object containing the data to be stored in the Model (i.e. attributes). The second parameter is an object containing instantiation options. You can add additional parameters and they are simply passed on to the initialize function.

## 6.4 - Overriding The Constructor Being Extended

When using `extend()` if you pass a property called 'constructor' with a function as its value, this function will be used instead of the function the `extend()` is a property of. In the code below I am extending not the `Model` constructor, but the constructor function I am passing in.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/gBjXx/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

In the code above `myModel` still inherits the `Model()` prototype properties, just not the instance properties (i.e. `cid`). If you override the constructor, but want to keep instance properties from the constructor you are calling `extend()` from, you need to run `Backbone.[CONSTRUCTOR].apply(this, arguments);` in the custom constructor*/

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/wpvBX/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>