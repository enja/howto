# 7 - Backbone.Router

## 7.1 - Backbone.Router() Overview

A Backbone route is a JavaScript string, which resembles what traditionally has been considered a URL [pathname](https://developer.mozilla.org/en-US/docs/Web/API/window.location). This pathname-like string is the property name for a function (or reference to a named function) that is invoked when the url in the browser matches the string. For example, the url below contains the pathname "help" and in a single page Backbone application this would tell Backbone to invoke the function that is associated with the route called 'help'.

```
http://www.hostname.com/#help
```

Notice that the pathname "help" isn't actually a [pathname](https://developer.mozilla.org/en-US/docs/Web/API/window.location), it is actually a [hash](http://en.wikipedia.org/wiki/Fragment_identifier). Backbone defaults to using hash paths because as of today its the most widely supported solution for creating unique URL strings without causing a browser to reload. When you no longer need to support ie 9 or below you can tell Backbone to use the newer HTML5 [history.pushState](https://developer.mozilla.org/en-US/docs/Web/Guide/API/DOM/Manipulating_the_browser_history) which eliminates the need for hash paths. The `history.pushState` api updates the browser history and permits the modification of the URL pathname without causing the browser to reload. I will talk more about this later in this section. For now, let's look at an actual Backbone route.

In the code below I create an instance of the default `Backbone.Router()` and then define a "help" route using the `route()` method.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/gn3kL/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

In the code example above when the hash changes to `#help` Backbone is aware of this change and takes everything after the `#` and matches that to a predefined string name (i.e. "help") which is associated with a callback function.

Routes are essentially pathname like strings in a URL that are monitored by Backbone for string matches. When a match is found a corresponding function is invoked.

### Notes:

- Routes by default rely on the [hashchange](https://developer.mozilla.org/en-US/docs/Web/API/window.onhashchange) event and the hash portion of a url. If Backbone is configured to use `history.pushState()` then the [popstate](https://developer.mozilla.org/en-US/docs/Web/API/window.onpopstate) event and normal pathnames are used if available, but will default back to hash's if its not. If Backbone detects that neither of these events are available it will resort to [polling](http://backbonejs.org/docs/backbone.html#section-172) the url and checking to see if the URL has changed.

## 7.2 - Starting Routing Management with `Backbone.history.start()`

To have Backbone begin managing url changes (i.e. call default route, listen for routes, manage browser history, and deal with back button) you will need to call the `Backbone.history.start()`. The details for this method can be found in the section that talks about `Backbone.History`. For now, just realize that Backbone has to manually tell the browser to start the routing process. In the code below I setup a 'help' route but a change to the url is not monitored by Backbone until `Backbone.history.start()` is invoked.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/kvABu/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

7.3 - Backbone Initial Route

The initial route is the route that runs when `Backbone.history.start()` is invoked. The initial route is defined by sending the router an empty string route name signifying that this route should run by default (i.e. the root) when routing begins. In the code example below I define an initial route that is called after `Backbone.history.start()` is invoked.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/zSGKQ/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Notes:

- To kick off routing without the initial route being invoked pass the `{silence:true}` to the `.start()` method.

## 7.4 - Defining Routes

Up to this point the routing code examples have been defining routes using the `route()` method after the instantiation of a `Backbone.Router()` instance. To be comprensive, defining routes can occur not just by way of the `route()` method but in the following four ways (including the `route()` method):

### 1 - When Extending `Backbone.Router` Using `routes` Option:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/3Qsak/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### 2 - When Instantiating A Router Using `routes` Option:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/2yaFA/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### 3 - After An Instance Is Created Using The route() Method:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/VqnDC/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### 4 - During Initialization Of An Instance Using The route() Method:

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/HTufd/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

## 7.5 - Running Routes With Wildcard Pathnames (aka splats or *)

A wildcard pathname can be used to indicate that any pathname will cause the route to run. For example, the route `'*anyURL'` will run anytime a url is changed.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/X72zF/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

And the route `'/help/*'` will run anytime the url changes to `'help/ANYTHING/ANYTHING'`.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/z8yyy/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Notes:

- Passing a splat route alone (i.e. `'*'`), today, causes Backbone to throw an error.

## 7.6 - Passing Parameters From The URL To The Routes Callback Function

To identify url parts that should be considered parameters simply place a `:` in front of the name of the parameter contained in the route string. For example in the code below I pass the search route callback function, 4 parameters.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/T5MYJ/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Notes:

- If you surround the url parameters in `()` then this becomes an optional parameter, without the `()` the url will only run if it contains all of the parameters defined in the route string.

## 7.7 - Using A Regular Expression With `route()` to Match A URL

The `route()` method optionally accepts as its first parameter a regular expression value instead of a string value. This can be pretty handy when you'd like to finely tune the matching of urls. In the code example below I demonstrate the matching of a route for a specific range of words.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/yUdwb/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

## 7.8 - Routing Broadcasts A Built In `'route:CALLBACK-NAME'` Event

When a route is match and the callback function is called a built in `'route'` event, with a namespace referring to the name of the callback invoked is dispatched/broadcasted by Backbone. The `on()` or `listenTo()` event methods can be used to tap into the `'route:NAMEOFCALLBACKFUNCTION'` event.

In the code below I am using `on()` or `listenTo()` to monitor and invoke additional callback functions when the `search` callback is invoked.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/47mL9/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

Notice that both `on()` or `listenTo()` pass along any url parameters.

### Note:

- In addition to the built int `'route:CALLBACK-NAME'` on route objects there is also a `'route'` event that gets dispatched anytime a route has been matched.

## 7.9 - Manually Navigating Routes using `navigate()`

Up to this point I've mostly been invoking routes in the code example by changing the `window.location.hash` value in the browser, which Backbone is monitoring. By using the `navigate()` method we can accomplish the same thing. In the code below instead of update the hash value in the browser I am going to invoke the `navigate()` method passing it the route string to navigate too.

<iframe width="100%" height="300" src="http://jsfiddle.net/codylindley/tAPn9/embedded/" allowfullscreen="allowfullscreen" frameborder="0"></iframe>

### Notes:

- By default, `navigate()` will update the url in the browser (and deal with history and back button) but not invoke the route callback function. To update the url in the browser and invoke the callback associated with the route you must pass the `trigger:true` option to `navigate()`.
- By default, `navigate()` assumes you want to change the url and update the browser's history. If you'd prefer not to update the browser history (which is used by the back button) you can pass the replace:true option to `navigate()`. This will simply replace the current url without updating the browsers history.